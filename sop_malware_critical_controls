# Standard Operating Procedure for compromise (malware) suspicion on Windows

# 1) Additional antimalware check

## Portable antimalware scan

### Run a full and portable antimalware scan

* My recommendation: [Microsoft Safety Scanner](https://learn.microsoft.com/en-us/microsoft-365/security/intelligence/safety-scanner-download?view=o365-worldwide)

## If no detection 

### Run an offline antimalware scan

* My recommendation: [Windows Defender Offline](https://support.microsoft.com/en-us/windows/help-protect-my-pc-with-microsoft-defender-offline-9306d528-64bf-4668-5b80-ff533f183d6c)


## If detection

### Handle the sample
* Try not to delete the file, and grab the sample;
* Send the sample to the support of the AV solution that was not detecting it.


# 2) IOC scanner

## Run a scanner with embedded IOC list

* My recommendation: [Thor Lite](https://www.nextron-systems.com/thor-lite/)
* Don't forget to extract your own IOC that are stored and updated within your TIP (either MISP or OpenCTI), and add them to Thor Lite
 

# 3) Live analysis tools

## SysInternals Suite

### Download
* [Download link](https://learn.microsoft.com/fr-fr/sysinternals/downloads/sysinternals-suite)

### Retrieve needed tools
* My recommendations: Process Explorer, Autoruns, TCPView
  * you may also want to leverage Process Monitor, but be aware it will consume quite some resources on the machine being analyzed, and the trace is likely to take time to analyze (hours if not days)

### Live check
* Run the Sysinternals tools
* Check for suspicious activity:
   * check all images of running processes and DLL:
     * unsigned binaries;
     * abnormal execution paths;
     * query VirusTotal (see Process Explorer options) for all binaries (exe/dll);
   * check all network activity (destination IP);
   * check for suspicious persistance items (using Autoruns)
   * check for suspicious filesystem activity.

## If detection

* Grab the sample and send it the the support of the AV vendor that was not detecting it.


## If no detection

### Run an anti-rootkit
* My recommednation: [GMER](http://www.gmer.net/?m=0)


# END



   

